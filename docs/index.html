<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<meta name="author" content="Doc Writer">
<title>Java Deep Learning Inference Services</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Java Deep Learning Inference Services</h1>
<div class="details">
<span id="author" class="author">Doc Writer</span><br>
<span id="email" class="email"><a href="mailto:christian.tzolov@mindmodel.io">christian.tzolov@mindmodel.io</a></span><br>
<span id="revnumber">version 0.0.1-SNAPSHOT,</span>
<span id="revdate">2019-04-18</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#service-catalog">Service Catalog</a>
<ul class="sectlevel2">
<li><a href="#object-detection">Object Detection</a></li>
<li><a href="#semantic-segmentation">Semantic Segmentation</a></li>
<li><a href="#pose-estimation">Pose Estimation</a></li>
<li><a href="#face-detection-mtcnn">Face Detection (MTCNN)</a></li>
<li><a href="#twitter-sentiment">Twitter Sentiment</a></li>
<li><a href="#image-intermediateResult">Image Recognition</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="openblock right">
<div class="content">
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image left"><a class="image" href="https://github.com/tzolov/mind-model-services"><img src="images/GitHub-logo.png" alt="GitHub logo" width="20"></a></span>
<a href="https://github.com/tzolov/mind-model-services">mind-model</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image left"><a class="image" href="https://twitter.com/christzolov"><img src="images/twitter_logo.png" alt="twitter logo" width="20"></a></span>
<a href="https://twitter.com/christzolov">@christzolov</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image left"><a class="image" href="https://www.linkedin.com/in/tzolov/"><img src="images/linkedin-logo.png" alt="linkedin logo" width="20"></a></span>
<a href="https://www.linkedin.com/in/tzolov/">tzolov</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="paragraph">
<p>User manual for the <a href="https://github.com/tzolov/mind-model-services">mind-model-services</a> collection of projects.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Java libraries for enabling and simplifying the inference of Deep Learning models.</p>
</div>
<div class="paragraph">
<p><span class="image right"><img src="images/reference-arch.png" alt="reference arch" width="80%"></span>
Provides Java wrappers for various state-of-the-art deep learning models. To be used in standalone Java
application, <a href="https://spring.io/projects/spring-boot">SpringBoot</a> microservices as well as <a href="https://cloud.spring.io/spring-cloud-stream/">Streaming</a>,
<a href="https://spring.io/projects/spring-cloud-task#learn">Task/Batch</a> and <a href="https://cloud.spring.io/spring-cloud-function/">Serverless</a> programing models.</p>
</div>
<div class="paragraph">
<p>The implementations use the <a href="https://www.tensorflow.org/install/lang_java">TensorFlow Java API</a> as well as the
<a href="https://deeplearning4j.org/docs/latest/nd4j-overview">DL4J</a> API stack such as <a href="https://github.com/bytedeco/javacv">JavaCV</a>,
<a href="https://deeplearning4j.org/docs/latest/nd4j-overview">ND4J</a> <a href="https://github.com/deeplearning4j/deeplearning4j/tree/master/nd4j/nd4j-tensorflow">nd4j-tensorflow</a>.</p>
</div>
<div class="paragraph">
<p>The pre-trained TensorFlow models can be loaded from <code>classpath</code>, <code>file</code> or <code>http</code> resource locations.
Also the models can be loaded directly from their <code>model-zoo</code> pages! For this just use the
following URI convention:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://&lt;Model's tar.gz URL&gt;#frozen_inference_graph.pb</pre>
</div>
</div>
<div class="paragraph">
<p>Where the <code>frozen_inference_graph.pb</code> is the frozen model&#8217;s file name within the archive specified with the URI.
Change the fragment name to match the file name within the model archive you use. The <code>frozen_inference_graph.pb</code>
seems to be used by default in many projects.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="service-catalog"><a class="anchor" href="#service-catalog"></a>Service Catalog</h2>
<div class="sectionbody">
<hr>
<div class="sect2">
<h3 id="object-detection"><a class="anchor" href="#object-detection"></a>Object Detection</h3>
<div class="paragraph lead">
<p>Java model inference library for the <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/README.md">TensorFlow Object Detection API</a>.
Allows real-time localization and identification of multiple objects in a single or batch of images.
Works with all <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md">pre-trained zoo models</a>
and <a href="https://github.com/tensorflow/models/tree/master/research/object_detection/data">object labels</a>.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/object_detection_1.jpg" alt="Object Detection 1" width="100%"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="https://github.com/tzolov/mind-model-services/blob/master/object-detection/src/main/java/io/mindmodel/services/object/detection/ObjectDetectionService.java">ObjectDetectionService</a>
takes an image or a batch of images and outputs a list of predicted objects bounding boxes
represented by <a href="https://github.com/tzolov/mind-model-services/blob/master/object-detection/src/main/java/io/mindmodel/services/object/detection/domain/ObjectDetection.java">ObjectDetection</a>.
For the models supporting <a href="https://github.com/tensorflow/models/tree/master/research/object_detection#february-9-2018">Instance Segmentation</a>,
the <code>ObjectDetectionService</code> can predict the instance segmentation <code>masks</code> in addition to object bounding boxes.</p>
<p class="tableblock">The <a href="https://github.com/tzolov/mind-model-services/blob/master/common/src/main/java/io/mindmodel/services/common/JsonMapperFunction.java">JsonMapperFunction</a> permits
converting the <code>List&lt;ObjectDetection&gt;</code> into JSON objects and the
<a href="https://github.com/tzolov/mind-model-services/blob/master/object-detection/src/main/java/io/mindmodel/services/object/detection/ObjectDetectionImageAugmenter.java">ObjectDetectionImageAugmenter</a>
allow to augment the input image with the detected bounding boxes and segmentation masks.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="usage"><a class="anchor" href="#usage"></a>Usage</h4>
<div class="paragraph">
<p>Add the <code>object-detection</code> dependency to the pom (use the latest version available):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.mindmodel.services<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>object-detection<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="example-1-object-detection"><a class="anchor" href="#example-1-object-detection"></a>Example 1: Object Detection</h5>
<div class="paragraph">
<p>The <a href="https://github.com/tzolov/mind-model-services/blob/master/object-detection/src/test/java/io/mindmodel/services/object/detection/examples/ExampleObjectDetection.java">ExampleObjectDetection.java</a>
sample demonstrates how to use the <code>ObjectDetectionService</code> for detecting objects in input images. It also shows how to
convert the result into JSON format and augment the input image with the detected object bounding boxes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td>
  <td class="code"><pre>ObjectDetectionService detectionService = <span class="keyword">new</span> ObjectDetectionService(
 <span class="string"><span class="delimiter">&quot;</span><span class="content">http://download.tensorflow.org/models/object_detection/faster_rcnn_nas_coco_2018_01_28.tar.gz#frozen_inference_graph.pb</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
 <span class="string"><span class="delimiter">&quot;</span><span class="content">https://raw.githubusercontent.com/tensorflow/models/master/research/object_detection/data/mscoco_label_map.pbtxt</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="2"></i><b>(2)</b>
 <span class="float">0.4f</span>, <i class="conum" data-value="3"></i><b>(3)</b>
 <span class="predefined-constant">false</span>, <i class="conum" data-value="4"></i><b>(4)</b>
 <span class="predefined-constant">true</span>); <i class="conum" data-value="5"></i><b>(5)</b>

<span class="type">byte</span><span class="type">[]</span> image = GraphicsUtils.loadAsByteArray(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/images/object-detection.jpg</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="6"></i><b>(6)</b>

<span class="predefined-type">List</span>&lt;ObjectDetection&gt; detectedObjects = detectionService.detect(image); <i class="conum" data-value="7"></i><b>(7)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Downloads and loads a pre-trained <code>frozen_inference_graph.pb</code> model directly from the <code>faster_rcnn_nas_coco.tar.gz</code> archive in the
Tensorflow model zoo. Mind that on first attempt it will download few hundreds of MBs. The consecutive runs will use the
cached copy (5) instead.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Object category labels (e.g. names) for the model</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Confidence threshold - Only object with estimate above the threshold are returned</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Indicate that this is not a <code>mask</code> (e.g. not an instance segmentation) model type</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Cache the model on the local file system.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Load the input image to evaluate</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Detect the objects in the image and represent the result as a list of ObjectDetection instances.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next you can convert the result in JSON format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre><span class="predefined-type">String</span> jsonObjectDetections = <span class="keyword">new</span> JsonMapperFunction().apply(detectedObjects);
<span class="predefined-type">System</span>.out.println(jsonObjectDetections);</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Object Detection JSON representation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">estimate</span><span class="delimiter">&quot;</span></span>:<span class="float">0.998</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x1</span><span class="delimiter">&quot;</span></span>:<span class="float">0.160</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y1</span><span class="delimiter">&quot;</span></span>:<span class="float">0.774</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x2</span><span class="delimiter">&quot;</span></span>:<span class="float">0.201</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y2</span><span class="delimiter">&quot;</span></span>:<span class="float">0.946</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">cid</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>},
 {<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">kite</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">estimate</span><span class="delimiter">&quot;</span></span>:<span class="float">0.998</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x1</span><span class="delimiter">&quot;</span></span>:<span class="float">0.437</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y1</span><span class="delimiter">&quot;</span></span>:<span class="float">0.089</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x2</span><span class="delimiter">&quot;</span></span>:<span class="float">0.495</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y2</span><span class="delimiter">&quot;</span></span>:<span class="float">0.169</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">cid</span><span class="delimiter">&quot;</span></span>:<span class="integer">38</span>},
 {<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">estimate</span><span class="delimiter">&quot;</span></span>:<span class="float">0.997</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x1</span><span class="delimiter">&quot;</span></span>:<span class="float">0.084</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y1</span><span class="delimiter">&quot;</span></span>:<span class="float">0.681</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x2</span><span class="delimiter">&quot;</span></span>:<span class="float">0.121</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y2</span><span class="delimiter">&quot;</span></span>:<span class="float">0.848</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">cid</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>},
 {<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">kite</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">estimate</span><span class="delimiter">&quot;</span></span>:<span class="float">0.988</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x1</span><span class="delimiter">&quot;</span></span>:<span class="float">0.206</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y1</span><span class="delimiter">&quot;</span></span>:<span class="float">0.263</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x2</span><span class="delimiter">&quot;</span></span>:<span class="float">0.225</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y2</span><span class="delimiter">&quot;</span></span>:<span class="float">0.314</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">cid</span><span class="delimiter">&quot;</span></span>:<span class="integer">38</span>}]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <a href="https://github.com/tzolov/mind-model-services/blob/master/object-detection/src/main/java/io/mindmodel/services/object/detection/ObjectDetectionImageAugmenter.java">ObjectDetectionImageAugmenter</a>
to draw the detected objects on top of the input image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre><span class="type">byte</span><span class="type">[]</span> annotatedImage = <span class="keyword">new</span> ObjectDetectionImageAugmenter().apply(image, detectedObjects); <i class="conum" data-value="1"></i><b>(1)</b>
IOUtils.write(annotatedImage, <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">./object-detection/target/object-detection-augmented.jpg</span><span class="delimiter">&quot;</span></span>)); <i class="conum" data-value="2"></i><b>(2)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Augment the image with the detected object bounding boxes (Uses Java2D internally).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Stores the augmented image as <code>object-detection-augmented.jpg</code> image file.</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Augmented object-detection-augmented.jpg file</div>
<p><span class="image"><img src="images/object-detection-augmented.jpg" alt="Object Detection" width="60%"></span></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Set the <code>ObjectDetectionImageAugmenter#agnosticColors</code> property to <code>true</code> to use a monochrome color schema.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="example-2-instance-segmentation"><a class="anchor" href="#example-2-instance-segmentation"></a>Example 2: Instance Segmentation</h5>
<div class="paragraph">
<p>The <a href="https://github.com/tzolov/mind-model-services/blob/master/object-detection/src/test/java/io/mindmodel/services/object/detection/examples/ExampleInstanceSegmentation.java">ExampleInstanceSegmentation.java</a>
sample shows how to use the <code>ObjectDetectionService</code> for <code>Instance Segmentation</code>.
NOTE: It requires a trained model that supports <code>Masks</code> as well as setting the instance segmentation (e.g. <code>useMasks</code>) flag to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre>ObjectDetectionService detectionService = <span class="keyword">new</span> ObjectDetectionService(
   <span class="string"><span class="delimiter">&quot;</span><span class="content">http://download.tensorflow.org/models/object_detection/mask_rcnn_inception_resnet_v2_atrous_coco_2018_01_28.tar.gz#frozen_inference_graph.pb</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
   <span class="string"><span class="delimiter">&quot;</span><span class="content">https://raw.githubusercontent.com/tensorflow/models/master/research/object_detection/data/mscoco_label_map.pbtxt</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="2"></i><b>(2)</b>
   <span class="float">0.4f</span>, <i class="conum" data-value="3"></i><b>(3)</b>
   <span class="predefined-constant">true</span>, <i class="conum" data-value="4"></i><b>(4)</b>
   <span class="predefined-constant">true</span>); <i class="conum" data-value="5"></i><b>(5)</b>

<span class="type">byte</span><span class="type">[]</span> image = GraphicsUtils.loadAsByteArray(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/images/object-detection.jpg</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">List</span>&lt;ObjectDetection&gt; detectedObjects = detectionService.detect(image); <i class="conum" data-value="6"></i><b>(6)</b>

<span class="predefined-type">String</span> jsonObjectDetections = <span class="keyword">new</span> JsonMapperFunction().apply(detectedObjects); <i class="conum" data-value="7"></i><b>(7)</b>
<span class="predefined-type">System</span>.out.println(jsonObjectDetections);

<span class="type">byte</span><span class="type">[]</span> annotatedImage = <span class="keyword">new</span> ObjectDetectionImageAugmenter(<span class="predefined-constant">true</span>) <i class="conum" data-value="8"></i><b>(8)</b>
    .apply(image, detectedObjects);
IOUtils.write(annotatedImage, <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">./object-detection/target/object-detection-segmentation-augmented.jpg</span><span class="delimiter">&quot;</span></span>));</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Uses one of the 4 MASK pre-trained models</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Object category labels (e.g. names) for the model</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Confidence threshold - Only object with estimate above the threshold are returned</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use masks output - For the pre-trained models instruct to use the extended fetch names that include instance segmentation masks as well.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Cache model - Create a local copy of the model to speed up consecutive runs.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Evaluate the model to predict the object in the input image.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Convert the detected object in to JSON array. NOTE: that with mask there is an additional field: <code>mask</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Draw the detected object on top of the input image. Mind the <code>true</code> constructor parameter stands for draw detected masks.
If false only the bounding boxes will be shown.</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Result augmented object-detection-segmentation-augmented.jpg file</div>
<p><span class="image"><img src="images/object-detection-segmentation-augmented.jpg" alt="Object Detection Augmented" width="60%"></span></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="models"><a class="anchor" href="#models"></a>Models</h4>
<div class="paragraph">
<p>All pre-trained <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md">detection_model_zoo.md</a>
models are supported. Following URI notation can be used to download any of the models directly from the zoo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://&lt;zoo model tar.gz url&gt;#frozen_inference_graph.pb</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>frozen_inference_graph.pb</code> is the frozen model file name within the archive.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For some models this name may differ. You have to download and open the archive to find the real name.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To speedup the bootstrap performance you may consider extracting the <code>frozen_inference_graph.pb</code> and caching it
locally. Then you can use the <code><a href="file://path-to-my-local-copy" class="bare">file://path-to-my-local-copy</a></code> URI schema to access it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Following models can be used for <code>Instance Segmentation</code> as well:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://download.tensorflow.org/models/object_detection/mask_rcnn_inception_resnet_v2_atrous_coco_2018_01_28.tar.gz">mask_rcnn_inception_resnet_v2_atrous_coco_2018_01_28.tar.gz</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://download.tensorflow.org/models/object_detection/mask_rcnn_inception_v2_coco_2018_01_28.tar.gz">mask_rcnn_inception_v2_coco_2018_01_28.tar.gz</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://download.tensorflow.org/models/object_detection/mask_rcnn_resnet101_atrous_coco_2018_01_28.tar.gz">mask_rcnn_resnet101_atrous_coco_2018_01_28.tar.gz</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://download.tensorflow.org/models/object_detection/mask_rcnn_resnet50_atrous_coco_2018_01_28.tar.gz">mask_rcnn_resnet50_atrous_coco_2018_01_28.tar.gz</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to the model, the <code>ObjectDetectionService</code> requires a list of labels that correspond to the categories detectable by the selected model.
All labels files are available in the <a href="https://github.com/tensorflow/models/tree/master/research/object_detection/data">object_detection/data</a> folder.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to use the labels that correspond to the model being used! Table below highlights this mapping.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">Table 1. Relationsip between trained model types and category labels</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Model</th>
<th class="tableblock halign-left valign-top">Labels</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md#coco-trained-models">coco</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://raw.githubusercontent.com/tensorflow/models/master/research/object_detection/data/mscoco_label_map.pbtxt">mscoco_label_map.pbtxt</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md#kitti-trained-models">kitti</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://raw.githubusercontent.com/tensorflow/models/master/research/object_detection/data/kitti_label_map.pbtxt">kitti_label_map.pbtxt</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md#open-images-trained-models">open-images</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/tensorflow/models/blob/master/research/object_detection/data/oid_bbox_trainable_label_map.pbtxt">oid_bbox_trainable_label_map.pbtxt</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md#inaturalist-species-trained-models">inaturalist-species</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://raw.githubusercontent.com/tensorflow/models/master/research/object_detection/data/fgvc_2854_classes_label_map.pbtxt">fgvc_2854_classes_label_map.pbtxt</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md#ava-v21-trained-models">ava</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://raw.githubusercontent.com/tensorflow/models/master/research/object_detection/data/ava_label_map_v2.1.pbtxt">ava_label_map_v2.1.pbtxt</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For performance reasons you may consider downloading the required label files to the local file system.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="build"><a class="anchor" href="#build"></a>Build</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ ./mvnw clean install</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="semantic-segmentation"><a class="anchor" href="#semantic-segmentation"></a>Semantic Segmentation</h3>
<div class="paragraph lead">
<p>Image Semantic Segmentation based on the state-of-art <a href="https://github.com/tensorflow/models/tree/master/research/deeplab">DeepLab</a> Tensorflow model.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/VikiMaxiAdi-all.png" alt="VikiMaxiAdi all" width="100%"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Semantic Segmentation is the process of associating each pixel of an image with a class label, (such as flower, person, road, sky, ocean, or car).
Unlike the <code>Instance Segmentation</code>, which produces instance-aware region masks, the <code>Semantic Segmentation</code> produces class-aware masks.
For implementing <code>Instance Segmentation</code> consult the <a href="#object-detection">Object Detection Service</a> instead.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <a href="https://github.com/tzolov/mind-model-services/blob/master/common/src/main/java/io/mindmodel/services/common/JsonMapperFunction.java">JsonMapperFunction</a> permits
converting the <code>List&lt;ObjectDetection&gt;</code> into JSON objects and the
<a href="https://github.com/tzolov/mind-model-services/blob/master/object-detection/src/main/java/io/mindmodel/services/object/detection/ObjectDetectionImageAugmenter.java">ObjectDetectionImageAugmenter</a>
allow to augment the input image with the detected bounding boxes and segmentation masks.</p>
</div>
<div class="sect3">
<h4 id="usage-2"><a class="anchor" href="#usage-2"></a>Usage</h4>
<div class="paragraph">
<p>Add the <code>semantic-segmentation</code> dependency to your pom (<em>use the latest version available</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.mindmodel.services<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>semantic-segmentation<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Following snippet demos how to use the PASCAL VOC model to apply mask to an input image</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>
SemanticSegmentationService segmentationService = <span class="keyword">new</span> SemanticSegmentationService(
  <span class="string"><span class="delimiter">&quot;</span><span class="content">http://download.tensorflow.org/models/deeplabv3_mnv2_pascal_trainval_2018_01_29.tar.gz#frozen_inference_graph.pb</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="predefined-constant">true</span>); <i class="conum" data-value="2"></i><b>(2)</b>

<span class="type">byte</span><span class="type">[]</span> inputImage = GraphicsUtils.loadAsByteArray(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/images/VikiMaxiAdi.jpg</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>

<span class="type">byte</span><span class="type">[]</span> imageMask = segmentationService.masksAsImage(inputImage); <i class="conum" data-value="4"></i><b>(4)</b>
<span class="predefined-type">BufferedImage</span> bi = <span class="predefined-type">ImageIO</span>.read(<span class="keyword">new</span> <span class="predefined-type">ByteArrayInputStream</span>(imageMask));
<span class="predefined-type">ImageIO</span>.write(bi, <span class="string"><span class="delimiter">&quot;</span><span class="content">png</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">./semantic-segmentation/target/VikiMaxiAdi_masks.png</span><span class="delimiter">&quot;</span></span>));

<span class="type">byte</span><span class="type">[]</span> augmentedImage = segmentationService.augment(inputImage); <i class="conum" data-value="5"></i><b>(5)</b>
IOUtils.write(augmentedImage, <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">./semantic-segmentation/target/VikiMaxiAdi_augmented.jpg</span><span class="delimiter">&quot;</span></span>));</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Download the PASCAL 2012 trained model directly from the web. The <code>frozen_inference_graph.pb</code> is the name of the model
file inside the <code>tar.gz</code> archive.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cache the downloaded model locally</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Load the input image as byte array</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Read get the segmentation mask as separate image</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Blend the segmentation mask on top of the original image</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="models-2"><a class="anchor" href="#models-2"></a>Models</h4>
<div class="paragraph">
<p>Based on the training datasets, three groups of pre-trained models provided:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/VikiMaxiAdi-all.png" alt="VikiMaxiAdi all" width="100%"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/tensorflow/models/blob/master/research/deeplab/g3doc/model_zoo.md#deeplab-models-trained-on-pascal-voc-2012">DeepLab models trained on PASCAL VOC 2012</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/cityscape-all-small.png" alt="cityscape all small" width="100%"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/tensorflow/models/blob/master/research/deeplab/g3doc/model_zoo.md#deeplab-models-trained-on-cityscapes">DeepLab models trained on Cityscapes</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/ADE20K-all-small.png" alt="ADE20K all small" width="100%"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/tensorflow/models/blob/master/research/deeplab/g3doc/model_zoo.md#deeplab-models-trained-on-ade20k">DeepLab models trained on ADE20K</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Select the model you want to use, copy its archive download Url and add a <code>#frozen_inference_graph.pb</code> fragment to it.
Later fragment is the frozen model&#8217;s file name inside the archive</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Download the archive and uncompress the <code>frozen_inference_graph.pb</code> for required model. Then use the <code><a href="file://&lt;local-file-name&gt" class="bare">file://&lt;local-file-name&gt</a>;</code> URI schema.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also convenience there are a couple of models, extracted from the archive and uploaded to bintray:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PASCAL VOC 2012 (default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dl.bintray.com/big-data/generic/deeplabv3_mnv2_pascal_train_aug_frozen_inference_graph.pb" class="bare">http://dl.bintray.com/big-data/generic/deeplabv3_mnv2_pascal_train_aug_frozen_inference_graph.pb</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CITYSCAPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dl.bintray.com/big-data/generic/deeplabv3_mnv2_cityscapes_train_2018_02_05_frozen_inference_graph.pb" class="bare">http://dl.bintray.com/big-data/generic/deeplabv3_mnv2_cityscapes_train_2018_02_05_frozen_inference_graph.pb</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADE20K</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dl.bintray.com/big-data/generic/deeplabv3_xception_ade20k_train_2018_05_29_frozen_inference_graph.pb" class="bare">http://dl.bintray.com/big-data/generic/deeplabv3_xception_ade20k_train_2018_05_29_frozen_inference_graph.pb</a></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="references"><a class="anchor" href="#references"></a>References:</h5>
<div class="ulist small">
<ul>
<li>
<p><a href="https://ai.googleblog.com/2018/03/semantic-image-segmentation-with.html">Semantic Image Segmentation with DeepLab in TensorFlow</a></p>
</li>
<li>
<p><a href="https://github.com/tensorflow/models/tree/master/research/deeplab">DeepLab Project</a></p>
</li>
<li>
<p><a href="https://medium.freecodecamp.org/how-to-use-deeplab-in-tensorflow-for-object-segmentation-using-deep-learning-a5777290ab6b">How to re-train DeepLab Segmentation models using Transfer Learning</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="build-2"><a class="anchor" href="#build-2"></a>Build</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ ./mvnw clean install</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="pose-estimation"><a class="anchor" href="#pose-estimation"></a>Pose Estimation</h3>
<div class="paragraph lead">
<p>Multi-person pose estimation service for detecting human figures in images and videos.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 66.6666%;">
<col style="width: 16.6668%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/VikiMaxiAdi.gif" alt="wk" width="100%"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The pose estimation service predicts where different body parts are located an how are they spatially relate to each
other. The implementation is based on the <a href="https://arxiv.org/pdf/1611.08050.pdf">Realtime Multi-Person 2D Pose Estimation using Part Affinity Fields</a>,
 <a href="https://github.com/CMU-Perceptual-Computing-Lab/openpose">OpenPose</a> and
 <a href="https://github.com/ildoonet/tf-pose-estimation">tf-pose-estimation</a>.</p>
<p class="tableblock">Service uses pre-trained <a href="https://github.com/ildoonet/tf-pose-estimation">tf-pose-estimation</a> TensorFlow models
  to predict the locations and the affinity of the body parts. Predictions are represented by <code>heatmaps</code>. Next
  the service applied few greedy algorithms to refine the parts in the heatmaps and to group them into poses.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/webcamPoseEstimation.gif" alt="ch" width="100%"></span></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="usage-3"><a class="anchor" href="#usage-3"></a>Usage</h4>
<div class="paragraph">
<p>Add the <code>pose-estimation</code> dependency to your pom (<em>Use the latest version available</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.mindmodel.services<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>pose-estimation<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a <code>PoseEstimationService</code> with the <code>cmu-graph_opt.pb</code> pre-trained model and use it to detect the poses
in the <code>tourists.jpg</code> image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>PoseEstimationService poseEstimationService = <span class="keyword">new</span> PoseEstimationService(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">https://dl.bintray.com/big-data/generic/2018-05-14-cmu-graph_opt.pb</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-constant">true</span>);<i class="conum" data-value="2"></i><b>(2)</b>
<span class="type">byte</span><span class="type">[]</span> inputImage = GraphicsUtils.loadAsByteArray(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/images/tourists.jpg</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">List</span>&lt;Body&gt; bodies = poseEstimationService.detect(inputImage);<i class="conum" data-value="3"></i><b>(3)</b>
<span class="predefined-type">String</span> bodiesJson = <span class="keyword">new</span> JsonMapperFunction().apply(bodies); <i class="conum" data-value="4"></i><b>(4)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>URI of the pre-trained, frozen Tensorflow model</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Download and cache the model locally.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Service takes an image (or batch of images) and the produces a list of detected Bodies.. The <strong>Body</strong> represents a single body posture found on the image. The Body is composed of Parts connected by Limbs.
The Limb contains a <code>PAF</code> (Part Affiliation Field) estimate score and the <code>from</code> and <code>to</code> parts it connects.
The <strong>Part</strong> has <code>type</code> and <code>coordinates</code> in the image.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use the <code>JsonMapperFunction</code> to turn the <code>Body</code> list into JSON objects. The output JSON format looks like:</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">0</span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">limbs</span><span class="delimiter">&quot;</span></span>: [
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">score</span><span class="delimiter">&quot;</span></span>:<span class="float">8.4396105</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">lShoulder</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>:<span class="integer">56</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>:<span class="integer">160</span>},
                         <span class="key"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">lEar</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>:<span class="integer">24</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>:<span class="integer">152</span>}},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">score</span><span class="delimiter">&quot;</span></span>:<span class="float">10.145516</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>:{ <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">neck</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>: <span class="integer">56</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>:<span class="integer">144</span>},
                         <span class="key"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">rShoulder</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>:<span class="integer">56</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>:<span class="integer">128</span>}},
 {<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">limbs</span><span class="delimiter">&quot;</span></span>: [
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">score</span><span class="delimiter">&quot;</span></span>:<span class="float">7.85779</span>,  <span class="key"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">neck</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>:<span class="integer">48</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>:<span class="integer">328</span>},
                         <span class="key"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">rHip</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>:<span class="integer">128</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>:<span class="integer">328</span>}},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">score</span><span class="delimiter">&quot;</span></span>:<span class="float">6.8949876</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">neck</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>:<span class="integer">48</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>:<span class="integer">328</span> },
                         <span class="key"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">lHip</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>:<span class="integer">128</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>:<span class="integer">304</span>}}]
}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or the <code>PoseEstimateImageAugmenter</code> function to draw the detected body skeletons on top of the input image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre><span class="type">byte</span><span class="type">[]</span> augmentedImage = <span class="keyword">new</span> PoseEstimateImageAugmenter().apply(inputImage, bodies);
IOUtils.write(augmentedImage, <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">./pose-estimation/target/tourists-augmented.jpg</span><span class="delimiter">&quot;</span></span>));</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotated images would look like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/tourists-augmented.jpg" alt="tourists augmented"></span></p>
</div>
<div class="paragraph">
<p>You can configure the <code>PoseEstimateImageAugmenter</code> to use different color schema or graphic characteristics.</p>
</div>
</div>
<div class="sect3">
<h4 id="models-3"><a class="anchor" href="#models-3"></a>Models</h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">Table 2. Pre-build models to use with the Pose Estimation Service</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Model Name</th>
<th class="tableblock halign-left valign-top">Model URI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thin - faster but less accurate (default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dl.bintray.com/big-data/generic/2018-30-05-mobilenet_thin_graph_opt.pb" class="bare">http://dl.bintray.com/big-data/generic/2018-30-05-mobilenet_thin_graph_opt.pb</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CMU - better accuracy but slower and large footprint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dl.bintray.com/big-data/generic/2018-05-14-cmu-graph_opt.pb" class="bare">http://dl.bintray.com/big-data/generic/2018-05-14-cmu-graph_opt.pb</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="build-3"><a class="anchor" href="#build-3"></a>Build</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git clone git@github.com:tzolov/mind-model-services.git
cd mind-model-services
$ mvn clean install</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="face-detection-mtcnn"><a class="anchor" href="#face-detection-mtcnn"></a>Face Detection (MTCNN)</h3>
<div class="paragraph lead">
<p>Placeholder for the existing <a href="https://github.com/tzolov/mtcnn-java">Face Detection MTCNN-Java</a> project.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The FaceDetection service uses a Tensorflow binding provided by the ND4J stack. Later is not compatible with the Google&#8217;s TensorFlow Java API.
This means that you can&#8217;t have in the same project dependency on the other <code>mind-model-services</code>.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/face-detection-maxi.gif" alt="Face Detection Maxi" width="100%"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Java</code> and <code>Tensorflow</code> implementation of the <a href="https://arxiv.org/abs/1604.02878">MTCNN Face Detector</a>. Based on
David Sandberg&#8217;s <a href="https://github.com/davidsandberg/facenet/tree/master/src/align">FaceNet&#8217;s MTCNN</a>
<code>python</code> implementation and the original <a href="https://arxiv.org/abs/1604.02878">Zhang, K et al. (2016) ZHANG2016</a> paper
and <a href="https://github.com/kpzhang93/MTCNN_face_detection_alignment">Matlab implementation</a>.</p>
<p class="tableblock">We&#8217;re considering moving the <a href="https://github.com/tzolov/mtcnn-java">mtcnn-java</a> project code under this projects umbrella. Until then follow the instruction provided there.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="usage-4"><a class="anchor" href="#usage-4"></a>Usage</h5>
<div class="paragraph">
<p>Use the following dependency to add the <code>mtcnn</code> utility to your project</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>net.tzolov.cv<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>mtcnn<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>0.0.4<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also register <code>jcentral</code> to your list of maven repository (it is available out of the box for Gradle).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;repositories&gt;</span>
    <span class="tag">&lt;repository&gt;</span>
      <span class="tag">&lt;id&gt;</span>jcenter<span class="tag">&lt;/id&gt;</span>
      <span class="tag">&lt;url&gt;</span>https://jcenter.bintray.com/<span class="tag">&lt;/url&gt;</span>
    <span class="tag">&lt;/repository&gt;</span>
<span class="tag">&lt;/repositories&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/tzolov/mtcnn-java/blob/master/src/test/java/net/tzolov/cv/mtcnn/sample/FaceDetectionSample1.java">FaceDetectionSample1.java</a> demonstrates how to use <code>MtcnnService</code> for detecting faces in images.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/FaceDetectionJavaMTCNN.png" alt="FaceDetectionJavaMTCNN"></span></p>
</div>
<div class="paragraph">
<p>Here is the essence this sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 1. Create face detection service.</span>
MtcnnService mtcnnService = <span class="keyword">new</span> MtcnnService(<span class="integer">30</span>, <span class="float">0.709</span>, <span class="keyword">new</span> <span class="type">double</span><span class="type">[]</span> { <span class="float">0.6</span>, <span class="float">0.7</span>, <span class="float">0.7</span> });

<span class="keyword">try</span> (<span class="predefined-type">InputStream</span> imageInputStream = <span class="keyword">new</span> DefaultResourceLoader() .getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/pivotal-ipo-nyse.jpg</span><span class="delimiter">&quot;</span></span>).getInputStream()) {
    <span class="comment">// 2. Load the input image (you can use http:/, file:/ or classpath:/ URIs to resolve the input image</span>
    <span class="predefined-type">BufferedImage</span> inputImage = <span class="predefined-type">ImageIO</span>.read(imageInputStream);
    <span class="comment">// 3. Run face detection</span>
    FaceAnnotation<span class="type">[]</span> faceAnnotations = mtcnnService.faceDetection(inputImage);
    <span class="comment">// 4. Augment the input image with the detected faces</span>
    <span class="predefined-type">BufferedImage</span> annotatedImage = MtcnnUtil.drawFaceAnnotations(inputImage, faceAnnotations);
    <span class="comment">// 5. Store face-annotated image</span>
    <span class="predefined-type">ImageIO</span>.write(annotatedImage, <span class="string"><span class="delimiter">&quot;</span><span class="content">png</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">./AnnotatedImage.png</span><span class="delimiter">&quot;</span></span>));
    <span class="comment">// 6. Print the face annotations as JSON</span>
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Face Annotations (JSON): </span><span class="delimiter">&quot;</span></span> + <span class="keyword">new</span> ObjectMapper().writeValueAsString(faceAnnotations));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It takes an input image detect the faces, produces json annotations and augments the image with the faces.</p>
</div>
<div class="paragraph">
<p>The face annotation json format looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[ {
  <span class="key"><span class="delimiter">&quot;</span><span class="content">bbox</span><span class="delimiter">&quot;</span></span> : { <span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span> : <span class="integer">331</span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span> : <span class="integer">92</span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">w</span><span class="delimiter">&quot;</span></span> : <span class="integer">58</span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">h</span><span class="delimiter">&quot;</span></span> : <span class="integer">71</span> }, <span class="key"><span class="delimiter">&quot;</span><span class="content">estimate</span><span class="delimiter">&quot;</span></span> : <span class="float">0.9999871253967285</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">landmarks</span><span class="delimiter">&quot;</span></span> : [ {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">LEFT_EYE</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">position</span><span class="delimiter">&quot;</span></span> : { <span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span> : <span class="integer">346</span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span> : <span class="integer">120</span> } }, {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">RIGHT_EYE</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">position</span><span class="delimiter">&quot;</span></span> : { <span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span> : <span class="integer">374</span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span> : <span class="integer">119</span> } }, {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">NOSE</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">position</span><span class="delimiter">&quot;</span></span> : { <span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span> : <span class="integer">359</span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span> : <span class="integer">133</span> } }, {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">MOUTH_LEFT</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">position</span><span class="delimiter">&quot;</span></span> : { <span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span> : <span class="integer">347</span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span> : <span class="integer">147</span> } }, {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">MOUTH_RIGHT</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">position</span><span class="delimiter">&quot;</span></span> : { <span class="key"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span> : <span class="integer">371</span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span> : <span class="integer">147</span> },
  } ]
}, {</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="twitter-sentiment"><a class="anchor" href="#twitter-sentiment"></a>Twitter Sentiment</h3>
<div class="paragraph lead">
<p>Performs sentiment classification on tweets. Uses a pre-trained TensorFlow model build with
<a href="https://github.com/danielegrattarola/twitter-sentiment-cnn">twitter-sentiment-cnn</a>.</p>
</div>
<div class="paragraph">
<p>Service can evaluates Tweet messages (in JSON format) and detects the sentiment: <code>POSITIVE</code>, <code>NEGATIVE</code> and <code>NEUTRAL</code>.</p>
</div>
<div class="paragraph">
<p>For real life application of the Twitter Sentiment Analysis check:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://www.youtube.com/watch?v=QzF2Iii4s5c[Real-time Twitter Sentiment Analytics with TensorFlow and Spring Cloud Dataflow]"><img src="images/tf-ts.jpg" alt="tf ts" width="30%"></a>
</div>
<div class="title">Figure 1. Real-time Twitter Sentiment Analytics with TensorFlow and Spring Cloud Dataflow</div>
</div>
<div class="sect3">
<h4 id="usage-5"><a class="anchor" href="#usage-5"></a>Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td>
  <td class="code"><pre><span class="predefined-type">String</span> tweet = <span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\&quot;</span><span class="content">text</span><span class="char">\&quot;</span><span class="content">: </span><span class="char">\&quot;</span><span class="content">This is really bad</span><span class="char">\&quot;</span><span class="content">, </span><span class="char">\&quot;</span><span class="content">id</span><span class="char">\&quot;</span><span class="content">:666, </span><span class="char">\&quot;</span><span class="content">lang</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">en</span><span class="char">\&quot;</span><span class="content"> }</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="1"></i><b>(1)</b>

TwitterSentimentService twitterSentimentService = <span class="keyword">new</span> TwitterSentimentService(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http://dl.bintray.com/big-data/generic/minimal_graph.proto</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http://dl.bintray.com/big-data/generic/vocab.csv</span><span class="delimiter">&quot;</span></span>,           <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="predefined-constant">true</span>); <i class="conum" data-value="4"></i><b>(4)</b>

SentimentResult tweetSentiment = twitterSentimentService.tweetSentiment(tweet); <i class="conum" data-value="5"></i><b>(5)</b>

<span class="predefined-type">System</span>.out.println(tweetSentiment.getSentiment() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> : </span><span class="delimiter">&quot;</span></span> + tweetSentiment.getEstimate());</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sample tweet message in JSON format.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Pre-trained model Uri.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The Uri of the Word vocabulary used to train the model.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Cache the TensorFlow model on the local file system.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use the service to detect the sentiment</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Would yield a result like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">NEGATIVE : 0.03941632</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next you can convert the result in JSON format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre><span class="predefined-type">String</span> jsonTweetSentiment = <span class="keyword">new</span> JsonMapperFunction().apply(tweetSentiment);
<span class="predefined-type">System</span>.out.println(jsonTweetSentiment);</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample tweet sentiment JSON representation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
 <span class="key"><span class="delimiter">&quot;</span><span class="content">sentiment</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">NEGATIVE</span><span class="delimiter">&quot;</span></span>,
 <span class="key"><span class="delimiter">&quot;</span><span class="content">estimate</span><span class="delimiter">&quot;</span></span>:<span class="float">0.03941632</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="models-4"><a class="anchor" href="#models-4"></a>Models</h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">Table 3. Pre-build models to use with the Twitter Setnimnet Service</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Model</th>
<th class="tableblock halign-left valign-top">URI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimal_graph (default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dl.bintray.com/big-data/generic/minimal_graph.proto" class="bare">http://dl.bintray.com/big-data/generic/minimal_graph.proto</a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">Table 4. Pre-build vacabulary to use with the Twitter Setnimnet Service</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vocabulary</th>
<th class="tableblock halign-left valign-top">URI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vocab.csv for minimal_graph(default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dl.bintray.com/big-data/generic/vocab.csv" class="bare">http://dl.bintray.com/big-data/generic/vocab.csv</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="build-4"><a class="anchor" href="#build-4"></a>Build</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ mvn clean install</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="image-intermediateResult"><a class="anchor" href="#image-intermediateResult"></a>Image Recognition</h3>
<div class="paragraph lead">
<p>Java model inference library for the <a href="https://github.com/tensorflow/models/tree/master/research/slim#pre-trained-models">Inception</a>, <a href="https://github.com/tensorflow/models/blob/master/research/slim/nets/mobilenet_v1.md#pre-trained-models">MobileNetV1</a> and <a href="https://github.com/tensorflow/models/tree/master/research/slim/nets/mobilenet#pretrained-models">MobileNetV2</a> image intermediateResult architectures.
Provides real-time intermediateResult of the <a href="https://dl.bintray.com/big-data/generic/imagenet_comp_graph_label_strings.txt">LSVRC-2012-CLS categories</a> in the input images.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/image-augmented.jpg" alt="Inception 1" width="100%"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="https://github.com/tzolov/mind-model-services/blob/master/image-intermediateResult/src/main/java/io/mindmodel/services/image/intermediateResult/ImageRecognitionService.java">ImageRecognitionService</a> takes an image and outputs a list of probable categories the image contains. The response is represented by <a href="https://github.com/tzolov/mind-model-services/blob/master/image-intermediateResult/src/main/java/io/mindmodel/services/image/intermediateResult/RecognitionResponse.java">RecognitionResponse</a> class.</p>
<p class="tableblock">The <a href="https://github.com/tzolov/mind-model-services/blob/master/common/src/main/java/io/mindmodel/services/common/JsonMapperFunction.java">JsonMapperFunction</a> permits
converting the <code>RecognitionResponse</code> into JSON objects and the
<a href="https://github.com/tzolov/mind-model-services/blob/master/image-intermediateResult/src/main/java/io/mindmodel/services/image/intermediateResult/ImageRecognitionAugmenter.java">ImageRecognitionAugmenter</a> can augment the input image with the detected categories (as shown in pic. 1).</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="usage-6"><a class="anchor" href="#usage-6"></a>Usage</h4>
<div class="paragraph">
<p>Add the <code>image-intermediateResult</code> dependency to the pom (use the latest version available):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.mindmodel.services<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>image-intermediateResult<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="example-1-image-intermediateResult"><a class="anchor" href="#example-1-image-intermediateResult"></a>Example 1: Image Recognition</h5>
<div class="paragraph">
<p>The <a href="https://github.com/tzolov/mind-model-services/blob/master/image-intermediateResult/src/test/java/io/mindmodel/services/image/intermediateResult/ImageRecognitionExample.java">ImageRecognitionExample.java</a> demonstrates how to use the <code>ImageRecognitionService</code> for detecting the categoryes present in an input image.
It also shows how to convert the result into JSON format and augment the input image with the detected category labels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre>ImageRecognitionService recognitionService = ImageRecognitionService.mobilenetModeV2(
  <span class="string"><span class="delimiter">&quot;</span><span class="content">https://storage.googleapis.com/mobilenet_v2/checkpoints/mobilenet_v2_1.4_224.tgz#mobilenet_v2_1.4_224_frozen.pb</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="integer">224</span>, <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="integer">5</span>, <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="predefined-constant">true</span>); <i class="conum" data-value="4"></i><b>(4)</b>

<span class="type">byte</span><span class="type">[]</span> inputImage = GraphicsUtils.loadAsByteArray(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/images/giant_panda_in_beijing_zoo_1.jpg</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="5"></i><b>(5)</b>

<span class="predefined-type">List</span>&lt;RecognitionResponse&gt; recognizedObjects = recognitionService.recognize(inputImage); <i class="conum" data-value="6"></i><b>(6)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Downloads and loads a pre-trained <code>mobilenet_v2_1.4_224_frozen.pb</code> model. Mind that on first attempt it will download few hundreds of MBs. The consecutive runs will use the cached copy (5) instead. The category labels for the MobileNetV2 are resolved from <code>src/main/resourcrds/labels/mobilenet_labels.txt</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The wxh sieze of the input nomralized image.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Top K result to return.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Cache the model on the local file system.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Load the image to recognise.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Return a map of the top-k most probable category names and their probabilites.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ImageRecognitionService.mobilenetModeV1</code> and <code>ImageRecognitionService.inception</code> factory metheods help to laod and configure pretrained mobilenetModeV1 and and Inception models.</p>
</div>
<div class="paragraph">
<p>Next you can convert the result in JSON format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre><span class="predefined-type">String</span> jsonRecognizedObjects = <span class="keyword">new</span> JsonMapperFunction().apply(recognizedObjects);</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Image Recognition JSON representation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">giant panda</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">probability</span><span class="delimiter">&quot;</span></span>:<span class="float">0.9946687817573547</span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Arctic fox</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">probability</span><span class="delimiter">&quot;</span></span>:<span class="float">0.0036631098482757807</span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">ice bear</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">probability</span><span class="delimiter">&quot;</span></span>:<span class="float">3.3782739774324E-4</span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">American black bear</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">probability</span><span class="delimiter">&quot;</span></span>:<span class="float">2.3452856112271547E-4</span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">skunk</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">probability</span><span class="delimiter">&quot;</span></span>:<span class="float">1.6454080468975008E-4</span>}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <a href="https://github.com/tzolov/mind-model-services/blob/master/image-intermediateResult/src/main/java/io/mindmodel/services/image/intermediateResult/ImageRecognitionAugmenter.java">ImageRecognitionAugmenter</a>
to draw the recognized categories on top of the input image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre><span class="type">byte</span><span class="type">[]</span> augmentedImage = <span class="keyword">new</span> ImageRecognitionAugmenter().apply(inputImage, recognizedObjects); <i class="conum" data-value="1"></i><b>(1)</b>
IOUtils.write(augmentedImage, <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">./image-intermediateResult/target/image-augmented.jpg</span><span class="delimiter">&quot;</span></span>));<i class="conum" data-value="2"></i><b>(2)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Augment the image with the recognized categories (uses Java2D internally).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Stores the augmented image as <code>image-augmented.jpg</code> image file.</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Augmented image-augmented.jpg file</div>
<p><span class="image"><img src="images/image-recogniyion-panda-augmented.jpg" alt="Augmented" width="60%"></span></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="models-5"><a class="anchor" href="#models-5"></a>Models</h4>
<div class="paragraph">
<p>This implementation supports all pretrained <a href="https://github.com/tensorflow/models/tree/master/research/slim#pre-trained-models">Inception</a>, <a href="https://github.com/tensorflow/models/blob/master/research/slim/nets/mobilenet_v1.md#pre-trained-models">MobileNetV1</a> and <a href="https://github.com/tensorflow/models/tree/master/research/slim/nets/mobilenet#pretrained-models">MobileNetV2</a> models.
Following URI notation can be used to download any of the models directly from the zoo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://&lt;zoo model tar.gz url&gt;#&lt;frozen inference graph name.pb&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;frozen inference graph name.pb&gt;</code> is the frozen model file name within the archive.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To speedup the bootstrap performance you may consider extracting the model and caching it
locally. Then you can use the <code><a href="file://path-to-my-local-copy" class="bare">file://path-to-my-local-copy</a></code> URI schema to access it.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to use the labels that correspond to the model being used! Table below highlights this mapping.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="build-5"><a class="anchor" href="#build-5"></a>Build</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ ./mvnw clean install</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.0.1-SNAPSHOT<br>
Last updated 2019-04-18 00:56:30 EEST
</div>
</div>
</body>
</html>